<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title th:text="${pageTitle}">FUTA</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}" type="text/css" media="all" />
    <link rel="stylesheet" th:href="@{/plugins/flexslider/flexslider.css}" type="text/css" media="all" />
    <script type="text/javascript" th:src="@{/js/jquery-1.11.3.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/plugins/flexslider/jquery.flexslider-min.js}"></script>
    <script type="text/javascript" th:src="@{/plugins/sliderTabs/jquery.sliderTabs.js}"></script>
    <link rel="stylesheet" th:href="@{/plugins/sliderTabs/styles/jquery.sliderTabs.css}" />
    <script type="text/javascript" th:src="@{/plugins/sidebar/slidebars.js}"></script>
    <link rel="stylesheet" th:href="@{/plugins/sidebar/slidebars.css}" />
    <script type="text/javascript" th:src="@{/js/theme.js}"></script>
</head>
<body>
<div id="sb-site">
    <!-- Header -->
    <header>
        <div id="top">
            <div class="container">
                <div class="support">
                    <i class="fa fa-phone"></i> Tổng đài hỗ trợ: <span th:text="${supportHotline}">0902 1818 52</span>
                </div>
                <ul style="list-style-type: none; margin: 0; padding: 0; display: flex; align-items: center;">
                    <!-- Hiển thị khi người dùng đã đăng nhập -->
                    <li th:if="${session.username != null}" style="display: flex; gap: 10px;">
                        <a href="#" style="text-decoration: none; pointer-events: none; cursor: default;">
                            Xin chào, <span th:text="${session.username}">Tên người dùng</span>
                        </a>
                        <a th:href="@{/logout}" style="text-decoration: none;">Đăng xuất</a>
                    </li>
                    <!-- Hiển thị khi người dùng chưa đăng nhập -->
                    <li th:if="${session.username == null}" style="display: flex; gap: 10px;">
                        <a th:href="@{/login}" style="text-decoration: none;">Đăng nhập</a>
                        <a th:href="@{/register}" style="text-decoration: none;">Đăng ký</a>
                    </li>
                </ul>


            </div>
        </div>
        <div id="header-body">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <h1 id="logo">
                            <a th:href="@{/}">
                                <img th:src="@{/img/logo.png}" alt="Logo FUTA" />
                            </a>
                        </h1>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <nav id="main-nav" class="clearfix">
                            <ul>
                                <li><a th:href="@{/promotions}">Khuyến mãi</a></li>
                                <li><a th:href="@{/schedule}">Lịch trình</a></li>
                                <li><a th:href="@{/contact}">Liên hệ</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Body Section -->
    <section id="body-top">
        <div class="container">
            <div class="row">
                <!-- Form Section -->
                <div class="col-lg-5 col-md-5">
                    <div>
                        <ul class="v-tabs clearfix" role="tablist">
                            <li role="presentation" class="active"><a href="#booking" aria-controls="booking" role="tab" data-toggle="tab">Mua vé trực tuyến</a></li>
                            <li role="presentation"><a href="#guide" aria-controls="guide" role="tab" data-toggle="tab">Hướng dẫn đặt vé</a></li>
                        </ul>

                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="booking">
                                <form th:action="@{/book/submit}" method="post" class="form">
                                    <!-- Dropdown điểm đi -->
                                    <div class="form-group">
                                        <label for="departure">Điểm đi</label>
                                        <select id="departure" name="departure" class="form-control">
                                            <option value="">Chọn điểm đi</option>
                                        </select>
                                    </div>

                                    <!-- Dropdown điểm đến -->
                                    <div class="form-group">
                                        <label for="arrival">Điểm đến</label>
                                        <select id="arrival" name="arrival" class="form-control">
                                            <option value="">Chọn điểm đến</option>
                                        </select>
                                    </div>

                                    <!-- Dropdown thời gian khởi hành -->
                                    <div class="form-group">
                                        <label for="departureTime">Thời gian khởi hành</label>
                                        <select id="departureTime" name="departureTime" class="form-control">
                                            <option value="">Chọn thời gian</option>
                                        </select>
                                    </div>


                                    <!-- Input số lượng vé -->
                                    <div class="form-group">
                                        <label for="quantity">Số lượng vé</label>
                                        <input id="quantity" name="quantity" type="number" class="form-control" min="1" max="10" value="1" required />
                                    </div>

                                    <!-- Nút Submit -->
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa fa-ticket"></i> Mua vé
                                    </button>
                                </form>

                            </div>

                            <div role="tabpanel" class="tab-pane" id="guide">
                                <p>Hướng dẫn chi tiết sẽ được hiển thị ở đây.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slider Section -->
                <div class="col-lg-7 col-md-7">
                    <div id="slider-home" class="flexslider">
                        <ul class="slides">
                            <li th:each="slide : ${slides}">
                                <a th:href="${slide.link}">
                                    <img th:src="${slide.image}" th:alt="${slide.alt}" />
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div id="footer-header">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3" th:each="linkGroup : ${footerLinks}">
                        <h4 th:text="${linkGroup.title}">Danh mục</h4>
                        <ul class="f-link">
                            <li th:each="link : ${linkGroup.links}">
                                <a th:href="${link.url}" th:text="${link.name}"></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer-body">
            <div class="container">
                <p>Công Ty CP Xe khách Phương Trang</p>
                <p th:text="'Địa chỉ: ' + ${address}"></p>
                <p>Điện thoại: <span th:text="${phone}"></span></p>
            </div>
        </div>
    </footer>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // URL API
        const apiUrl = '/api/schedules';

        // Fetch dữ liệu từ API
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                populateDropdowns(data);
            })
            .catch(error => console.error('Error fetching schedules:', error));
    });

    function populateDropdowns(schedules) {
        const departureDropdown = document.getElementById('departure');
        const arrivalDropdown = document.getElementById('arrival');
        const departureTimeDropdown = document.getElementById('departureTime');

        // Clear existing options (nếu có)
        departureDropdown.innerHTML = '<option value="">Chọn điểm đi</option>';
        arrivalDropdown.innerHTML = '<option value="">Chọn điểm đến</option>';
        departureTimeDropdown.innerHTML = '<option value="">Chọn thời gian</option>';

        // Duyệt qua danh sách và thêm option cho từng dropdown
        schedules.forEach(schedule => {
            // Thêm điểm đi
            if (!Array.from(departureDropdown.options).some(option => option.value === schedule.departureStation)) {
                const option = document.createElement('option');
                option.value = schedule.departureStation;
                option.textContent = schedule.departureStation;
                departureDropdown.appendChild(option);
            }

            // Thêm điểm đến
            if (!Array.from(arrivalDropdown.options).some(option => option.value === schedule.arrivalStation)) {
                const option = document.createElement('option');
                option.value = schedule.arrivalStation;
                option.textContent = schedule.arrivalStation;
                arrivalDropdown.appendChild(option);
            }

            // Thêm thời gian khởi hành
            const timeOption = document.createElement('option');
            timeOption.value = schedule.departureTime;
            timeOption.textContent = new Date(schedule.departureTime).toLocaleString(); // Format thời gian
            departureTimeDropdown.appendChild(timeOption);
        });
    }
</script>

</body>
</html>
