<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link type="text/css" th:href="@{/admin/css/index.css}" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Thêm jQuery từ CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="area"></div>
<div class="dashboard-container">
    <nav class="main-menu">
        <ul>
            <li>
                <a href="#" id="manage-user-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/3177/3177440.png" alt="Quản lý tài khoản" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                               Quản lý tài khoản
                            </span>
                </a>

            </li>
            <li class="has-subnav">
                <a href="#" id="manage-trip-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/17212/17212113.png" alt="Quản lý chuyến xe" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Quản lý chuyến xe
                            </span>
                </a>

            </li>
            <li class="has-subnav">
                <a href="#" id="manage-bus-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/15553/15553211.png" alt="Quản lý xe" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Quản lý xe
                            </span>
                </a>

            </li>
            <li class="has-subnav">
                <a href="#" id="manage-station-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/6395/6395324.png" alt="Trạm xe" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Trạm xe
                            </span>
                </a>

            </li>
            <li>
                <a href="#" id="manage-company-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/4300/4300059.png" alt="Công ty" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Công ty
                            </span>
                </a>
            </li>
            <li>
<!--                <a href="#" id="manage-seat-link">-->
<!--                    <img src="https://cdn-icons-png.flaticon.com/128/1683/1683707.png" alt="Quản lý tài khoản" style="width: 50px; height: 50px; margin-right: 20px;">-->
<!--                    <span class="nav-text">-->
<!--                               Chỗ ngồi-->
<!--                            </span>-->
<!--                </a>-->
<!--            </li>-->
            <li>
                <a href="#" id="manage-seat-type-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/17386/17386784.png" alt="Loại chỗ ngồi" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Loại chỗ ngồi
                            </span>
                </a>
            </li>
            <li>
                <a href="#" id="manage-ticket-link">
                    <img src="https://cdn-icons-png.flaticon.com/128/3355/3355184.png" alt="Vé" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Vé
                            </span>
                </a>
            </li>
            <li>
                <a href="#" id="statistical-payment">
                    <img src="https://cdn-icons-png.flaticon.com/128/11083/11083287.png" alt="Thống kê" style="width: 50px; height: 50px; margin-right: 20px;">
                    <span class="nav-text">
                                Thống kê
                            </span>
                </a>
            </li>
        </ul>

        <ul class="logout">
            <li>
                <a th:href="@{/login}">
                    <i class="fa fa-power-off fa-2x"></i>
                    <span class="nav-text">
                                Logout
                            </span>
                </a>
            </li>
        </ul>
    </nav>
    <div id="dashboard-content">
        <!-- Nội dung được load tại đây -->
    </div>
</div>

<script>
    document.getElementById('manage-user-link').addEventListener('click', function (event) {
        event.preventDefault(); // Ngăn trình duyệt tải lại trang
        fetch('/admin/user')
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading user form:', error));
    });
    document.getElementById('manage-trip-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-schedule/trip')  // Assuming '/admin/trip' is the URL for your trip form
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading trip form:', error));
    });
    document.getElementById('manage-station-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-station/station')  // Assuming '/admin/trip' is the URL for your trip form
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading trip form:', error));
    });
    document.getElementById('manage-bus-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-bus/bus')  // Assuming '/admin/trip' is the URL for your trip form
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading trip form:', error));
    });
    document.getElementById('manage-company-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-company/company')  // Assuming '/admin/trip' is the URL for your trip form
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading trip form:', error));
    });
    // document.getElementById('manage-seat-link').addEventListener('click', function (event) {
    //     event.preventDefault(); // Prevent page reload
    //     fetch('/admin-seater/seat')  // Assuming '/admin/trip' is the URL for your trip form
    //         .then(response => response.text())
    //         .then(html => {
    //             document.getElementById('dashboard-content').innerHTML = html;
    //         })
    //         .catch(error => console.error('Error loading trip form:', error));
    // });
    document.getElementById('manage-seat-type-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-type/type')  // Assuming '/admin/trip' is the URL for your trip form
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading trip form:', error));
    });
    document.getElementById('manage-ticket-link').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-ticket/ticket')  // Assuming '/admin/trip' is the URL for your trip form
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
            })
            .catch(error => console.error('Error loading trip form:', error));
    });
    document.getElementById('statistical-payment').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload
        fetch('/admin-payment/payment-statistics')
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-content').innerHTML = html;
                // After content is loaded, initialize the JS for statistical page
                initializeStatisticalPage();
            })
            .catch(error => console.error('Error loading statistics form:', error));
    });

    function initializeStatisticalPage() {
        $(document).ready(function () {
            const ctx = document.getElementById('statisticsChart').getContext('2d');
            let chart;

            function createChart(labels, data, label) {
                if (chart) {
                    chart.destroy();
                }
                chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Thời gian'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Doanh thu (VNĐ)'
                                }
                            }
                        }
                    }
                });
            }

            function fetchData(filter) {
                $.get('/admin-payment/payment-statistics-data', function (data) {
                    let stats;
                    let labels;
                    let labelText;

                    if (filter === 'daily') {
                        stats = data.dailyPayments;
                        labels = Object.keys(stats);
                        labelText = 'Doanh thu theo ngày';
                    } else if (filter === 'monthly') {
                        stats = data.monthlyPayments;
                        labels = Object.keys(stats);
                        labelText = 'Doanh thu theo tháng';
                    } else if (filter === 'yearly') {
                        stats = data.yearlyPayments;
                        labels = Object.keys(stats);
                        labelText = 'Doanh thu theo năm';
                    }

                    const values = Object.values(stats);
                    createChart(labels, values, labelText);
                });
            }

            fetchData('daily'); // Mặc định theo ngày
            $('#filter').on('change', function () {
                const filter = $(this).val();
                fetchData(filter);
            });
        });

    }

</script>
<!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>-->
<!--&lt;!&ndash; Thêm jQuery từ CDN &ndash;&gt;-->
<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
<script th:src="@{/admin/js/user.js}"></script>
<script th:src="@{/admin/js/trip.js}"></script>
<script th:src="@{/admin/js/buscompany.js}"></script>
<script th:src="@{/admin/js/busstation.js}"></script>
<script th:src="@{/admin/js/seat.js}"></script>
<script th:src="@{/admin/js/bus.js}"></script>
<script th:src="@{/admin/js/stype.js}"></script>
</body>
</html>
